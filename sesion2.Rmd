# CURSO DE ACTUALIZACION EN ESTADISTICA

#### Profesor: Dr. José Manuel MAGALLANES, Ph.D

____

## Sesión 2: 

## **Exploración de Datos Categóricos**

____

Explorar es el primer paso del análisis estadístico. Es el momento en que, guiados por nuestros conocimientos previos, elegimos de las variables disponibles aquellas que tengan relevancia para nuestro proceso decisional.

La exploración es un proceso para darle soporte estadístico a nuestra intuición. Este proceso se hace según el tipo de variable. En esta sesión veremos la exploración de las variables categóricas.

### Parte 1. **Tablas de Frecuencia**

Las variables categóricas tienen un limitado y pequeño numero de modalidades o niveles. De ahí que ver el conteo de cada una de éstas nos permite conocer la distribución de la variable.

```{r, eval=TRUE}
LINK='https://docs.google.com/spreadsheets/d/e/2PACX-1vSKuD4fkPOCgoRhefu9cDLzKJe-tkZ8V0EDPihgr2B6PZK3j-MGAfcSyNRQ91hzhuEh_iCebo1-8DWu/pub?gid=775750542&single=true&output=csv'
mineria=read.csv(LINK,stringsAsFactors = F)
```

Veamos nuestras variables:
```{r, eval=TRUE}
str(mineria)
```

La data nos informa sobre el mineral o minerales que se explota en un proyecto minero y la región donde se ubica el proyecto. Trabajemos con los minerales:

```{r, eval=TRUE}
table(mineria$Mineral)
```

Una mejor manera de producir la tabla para un formato web:

```{r, eval=TRUE}
library(knitr)
count=table(mineria$Mineral)
share=prop.table(count)
kable(cbind(count,share),digits = 2)
```



2. Gráfico
```{r, eval=TRUE}
library(ggplot2)
library(scales)
base = ggplot(data=mineria,aes(x=Mineral))
bar1 = base + geom_bar()
bar1 
```

```{r, eval=TRUE}
base = ggplot(data=mineria,aes(x=Mineral))
bar1 = base + geom_bar(aes(y = (..count..)/sum(..count..)))
bar1 
```


```{r, eval=TRUE}
bar1 + labs(y="Proporcion",
            title="Minerales del Peru", 
            subtitle = "Proyectos actuales",
            caption = "Fuente: MINEM") + scale_y_continuous(labels = scales::percent)
```




Las variables anteriores son un ejemplo del tipo **nominal**. Los nombres de los minerales mostrados no tienen un orden más allá de lo alfabético. Lo que es más, no es que un mineral pueda pasar por todos esos estados, es simplemente su tipo. Cuando trabajamos con nominales, la mayoría de las veces no es necesario transformar la columna de tipo texto en categórica (o _factor_ como se le denomina en _R_).

De las tablas de frecuencia, podemos concluir que el Cobre es el mineral que tiene más proyectos en el país. De todos modos, dado que la variable es nominal, podemos _reacomodar_ el orden de presentación de las modalides usando la función **fct_infreq** de la biblioteca _forcats_:

```{r, eval=TRUE}
library(forcats)

base = ggplot(data=mineria,aes(x=fct_infreq(Mineral))) # cambio
bar1 = base + geom_bar(aes(y = (..count..)/sum(..count..)))
bar1 = bar1 + labs(x="Mineral",
                   y="Proporcion",
                   title="Minerales del Peru", 
                   subtitle = "Proyectos actuales",
                   caption = "Fuente: MINEM") 
bar1 + scale_y_continuous(labels = scales::percent)

```

Claro está que podemos plantear orden ascendente con **fct_rev** (también de _forcats_):

```{r, eval=TRUE}
base = ggplot(data=mineria,aes(x=fct_rev(fct_infreq(Mineral)))) # cambio
bar1 = base + geom_bar(aes(y = (..count..)/sum(..count..)))
bar1 = bar1 + labs(x="Mineral",
                   y="Proporcion",
                   title="Minerales del Peru", 
                   subtitle = "Proyectos actuales",
                   caption = "Fuente: MINEM") 
bar1 + scale_y_continuous(labels = scales::percent)
```

Veamos otros datos:

```{r, eval=TRUE}
link2='https://docs.google.com/spreadsheets/d/e/2PACX-1vSKuD4fkPOCgoRhefu9cDLzKJe-tkZ8V0EDPihgr2B6PZK3j-MGAfcSyNRQ91hzhuEh_iCebo1-8DWu/pub?gid=1869012038&single=true&output=csv'

accidentes=read.csv(link2, stringsAsFactors = F)

str(accidentes)
```

Estos datos nos informan los accidentes que se dieron en proyectos mineros entre los años 2000 al 2006. Veamos la columna _Tama_:

```{r, eval=TRUE}
table(accidentes$Tama)
```

Este es un claro ejemplo de variable **ordinal**. En este caso, un proyecto podría pasar por alguno de estos niveles. Por defecto, _R_ presenta la tabla en orden alfabético. Aquí sí debemos transformar la variable en el tipo que corresponde, y a la vez indicar el orden correcto:

```{r, eval=TRUE}
library(stats)
accidentes$Tama=factor(accidentes$Tama,
                       levels=c('Pequeña','Mediana','Grande'),
                       ordered = T)
```

```{r, eval=TRUE}
count=table(accidentes$Tama)
share=prop.table(count)
cumulative_Count=cumsum(count)
cumulative_Share=cumsum(share)
kable(cbind(count,cumulative_Count,share,cumulative_Share),digits = 2)
```


```{r, eval=TRUE}
base = ggplot(data=accidentes,aes(x=Tama))
bar2 = base + geom_bar(aes(y = (..count..)/sum(..count..)))
bar2= bar2 + labs(x='Tamaño de Proyecto',
                  y="Proporcion",
                  title="Accidentes en proyectos mineros", 
                  subtitle = "Años: 2000 al 2006",
                  caption = "Fuente: MINEM") 
bar2 + scale_y_continuous(labels = scales::percent)
```

Aquí si, técnicamente, no podemos reordenar las modalidades. Y del análisis visual, podemos ver que los accidentes son más frecuentes en proyectos de mediana envergadura.


### Parte 2. **Medidas de resumen**

1. **Caso Nominal**. Las variables en escala nominal tienen las siguientes medidas de resumen:

* Centralidad: La moda, el valor que más se repite:

```{r, eval=TRUE}
library(DescTools)
Mode(mineria$Mineral)
```

* Concentración: Este es un coeficiente que permite calificar qué tan buena es la moda, y a la vez qué tanta participación tienen los demás:

  - < 0.01 : indica que la moda no es significativa, las categorias se distribuyen uniformemente.
  - menos de 0.15 : indica que la moda no es significativa, puede haber multimodalidad.
  - entre 0.15 - 0.25: hay una moda.
  - mas de 0.25: hay una moda y los demás valores están lejos de 'hacerle pelea'.

Podemos usar el indice de Herfindahl- Hirschman

```{r, eval=TRUE}
Herfindahl(table(mineria$Mineral))
```

Sabiendo que hay poca competencia, podemos calcular el indice de Laakso - Taagepera:

```{r, eval=TRUE}
1/Herfindahl(table(mineria$Mineral))
```

Esto indica que hay en efecto 2 minerales mas representativos entre todos los proyectos.


____

2. **Caso Ordinal**. Las variables en escala nominal tienen las siguientes medidas de resumen:

* Centralidad: 
  - La moda, el valor que más se repite.
  - La mediana.

```{r, eval=TRUE}
Mode(accidentes$Tama)
```

  
```{r, eval=TRUE}
Median(accidentes$Tama)
```

* Concentración: Podemos usar el indice de Herfindahl- Hirschman

```{r, eval=TRUE}
Herfindahl(table(accidentes$Tama))
```

Sabiendo que hay poca competencia, podemos calcular el indice de Laakso - Taagepera:

```{r, eval=TRUE}
1/Herfindahl(table(accidentes$Tama))
```

Esto indica que hay en efecto 1 minerales mas representativos entre todos los proyectos.

* Simetria

* Dispersion

____


Practique y pase a resolver estos [ejercicios](https://htmlpreview.github.io/?https://github.com/CoursesAndTutorials/Estadistica/blob/master/sesion1_ejercicio.html).

____

[Volver al programa del curso](https://coursesandtutorials.github.io/Estadistica/)

